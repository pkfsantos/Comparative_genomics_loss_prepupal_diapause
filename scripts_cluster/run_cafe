#!/usr/bin/env bash
#SBATCH --partition=kapheim-shared-kp
#SBATCH --account=kapheim-kp
#SBATCH --mem=6GB
#SBATCH --ntasks 2
#SBATCH --time 96:00:00
#bash script for executing snakemake in cluster
#important note yaml files need to have exactly four spaces to constitute an indent
#you can change partition to and from kapheim-kp to kingspeak and account from kapheim-kp kapheim in the yaml file whose name is cluster.yaml
#--error=front-%j.err --job-name=front-%j.out"

#input gene count processing - followed: https://github.com/harish0201/Analyses_Pipelines/blob/main/7.CAFE.sh
#Gene counts - I used output file from Orthofinder - Orthogroups folder - Orthogroups.GeneCount.tsv 
#tree - I used the species tree generated by orthofinder (modified in mesquite to match consensus in literature)
#tree - made it ultrametric using script available by orthofinder (tools/make_ultrametric.py)

#Input processing
#mv Orthogroups.GeneCount.tsv Orthogroups_GeneCount.tsv
#awk -F'\t' '{print "(null)\t"$0}' Orthogroups_GeneCount.tsv > tmp.tsv
#nano tmp.tsv (Changed first column name to "Desc"
#remove total column from tmp.tsv - awk -F'\t' '{$NF=""; print $0}' tmp.tsv | rev | sed 's/^\s*//g' | rev | tr ' ' '\t' > mod.tsv


#Tree processing
#make_ultrametric.py SpeciesTree_rooted_mesquite.txt
#mv SpeciesTree_rooted_mesquite.txt.ultrametric.tre speciesTree_ultrametric.tre

#RUN CAFE
#filter one or more gene families >= 100 genes 
#python /uufs/chpc.utah.edu/common/home/u6021652/CAFE5/bin/clade_and_size_filter.py -i mod.tsv -s -o cafe.input.tsv

#estimate lambda for the whole tree
/uufs/chpc.utah.edu/common/home/u6021652/CAFE5/bin/cafe5 -i cafe.input.tsv -t speciesTree_ultrametric.tre

#draw results
#python /uufs/chpc.utah.edu/common/home/u6021652/CAFE5/bin/cafe5_draw_tree.py -i results/Base_clade_results.txt -d results/Base_report.cafe -o clade_results.png
